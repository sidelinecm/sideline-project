# =========================================================
# üèóÔ∏è NETLIFY ULTIMATE CONFIGURATION
# =========================================================
[build]
  publish = "."
  command = "" 
  environment = { NODE_VERSION = "18" }

# =========================================================
# ‚öôÔ∏è CONFIG FOR FUNCTIONS ENVIRONMENT VARIABLES (*** ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏•‡πâ‡∏ß ***)
# ‡πÅ‡∏Å‡πâ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ context.env ‡πÄ‡∏õ‡πá‡∏ô undefined ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏´‡πâ‡πÇ‡∏´‡∏•‡∏î Env Vars
# =========================================================
[functions]
  environment = { SUPABASE_ANON_KEY = "${SUPABASE_ANON_KEY}", SUPABASE_URL = "${SUPABASE_URL}" }


# =========================================================
# ü§ñ EDGE FUNCTIONS (SEO & SITEMAP ENGINE)
# =========================================================

# 1. Sitemap ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Real-time)
[[edge_functions]]
function = "sitemap"
path = "/sitemap.xml"

# 2. ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Bot/Facebook/Line Preview)
[[edge_functions]]
function = "render-bot"
path = "/profile/*"

[[edge_functions]]
function = "render-bot"
path = "/sideline/*"

# 3. ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Bot)
[[edge_functions]]
function = "ssr-province"
path = "/location/*"

[[edge_functions]]
function = "ssr-province"
path = "/province/*"

# =========================================================
# ‚ö° SECURITY & CACHE HEADERS
# =========================================================
[[headers]]
  for = "/*"
  [headers.values]
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "SAMEORIGIN"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), camera=(), microphone=()"

# HTML: ‡∏´‡πâ‡∏≤‡∏° Cache (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ User ‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏™‡∏°‡∏≠)
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=0, must-revalidate"

# Assets (JS/CSS/Images): Cache 1 ‡∏õ‡∏µ (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î)
[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"
    
[[headers]]
  for = "/js/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/css/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# =========================================================
# üîÄ REDIRECT RULES (SPA FALLBACK)
# =========================================================
# ‡∏Å‡∏é‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ó‡∏∏‡∏Å URL ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á ‡πÉ‡∏´‡πâ‡∏™‡πà‡∏á‡πÑ‡∏õ index.html ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ JS ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
