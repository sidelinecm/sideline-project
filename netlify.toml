# =========================================================================
# ส่วนที่ 1: การตั้งค่า Build (Build Settings)
# =========================================================================
[build]
  publish = "."               # Netlify จะเสิร์ฟไฟล์จาก Root directory ของ Repository
  functions = "netlify/functions" # โฟลเดอร์สำหรับ Netlify Functions (ถ้ามี)

# แก้ปัญหา URL มี .html และจัดระเบียบโครงสร้าง Link ทั้งเว็บ
[build.processing]
  skip_processing = false     # ไม่ข้ามกระบวนการ Build ของ Netlify
[build.processing.html]
  pretty_urls = true          # ทำให้ URL ไม่มี .html เช่น about.html -> /about

# =========================================================================
# ส่วนที่ 2: การตั้งค่า Headers (HTTP Headers)
# =========================================================================
[[headers]]
  for = "/*"                  # ใช้กับทุก Path
  [headers.values]
    X-Content-Type-Options = "nosniff"          # ป้องกัน MIME-sniffing
    X-Frame-Options = "SAMEORIGIN"              # ป้องกัน Clickjacking
    X-XSS-Protection = "1; mode=block"          # ป้องกัน XSS
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload" # บังคับใช้ HTTPS (HSTS)
    Referrer-Policy = "strict-origin-when-cross-origin" # ควบคุมข้อมูล Referrer
    Cache-Control = "public, max-age=0, must-revalidate" # ตั้งค่า Cache สำหรับไฟล์ (public, ไม่แคชในเบราว์เซอร์, ต้องตรวจสอบซ้ำ)

# =========================================================================
# ส่วนที่ 3: Netlify Edge Functions (สำหรับ Netlify Edge Functions ของคุณ)
# =========================================================================
[[edge_functions]]
  function = "sitemap"        # Edge Function สำหรับ sitemap
  path = "/sitemap.xml"

[[edge_functions]]
  function = "render-bot"     # Edge Function สำหรับการ Render Bot
  path = "/sideline/*"

[[edge_functions]]
  function = "ssr-province"   # Edge Function สำหรับ SSR จังหวัด
  path = "/location/*"

[[edge_functions]]
  function = "ssr-province"   # Edge Function สำหรับ SSR จังหวัด
  path = "/province/*"

# =========================================================================
# ส่วนที่ 4: การจัดการ Redirects และ Rewrites ของ Netlify
#          (จัดลำดับความสำคัญจาก Specific ไป General)
# =========================================================================

# 1. บังคับใช้ HTTPS (HTTP -> HTTPS 301 Redirect)
[[redirects]]
  from = "http://sidelinechiangmai.netlify.app/*"
  to = "https://sidelinechiangmai.netlify.app/:splat"
  status = 301
  force = true

# 2. เสิร์ฟไฟล์ Service Worker และ Web Manifest โดยตรง (200 OK)
#    - ไม่จำเป็นต้องมี force = true หากเป็นไฟล์จริงที่อยู่ใน publish directory
[[redirects]]
  from = "/sw.js"
  to = "/sw.js"
  status = 200
  # force = true # สามารถเอาออกได้ถ้ามั่นใจว่าไฟล์นี้มีอยู่จริงและไม่ต้องการ rewrite ทับ

[[redirects]]
  from = "/manifest.webmanifest"
  to = "/manifest.webmanifest"
  status = 200
  # force = true # สามารถเอาออกได้ถ้ามั่นใจว่าไฟล์นี้มีอยู่จริงและไม่ต้องการ rewrite ทับ

# 3. SPA Fallback สำหรับ Path เฉพาะ (200 OK Rewrites)
#    - สำหรับ URL ที่เกี่ยวข้องกับ location, province, profiles
#    - ให้ชี้ไปที่ index.html เพื่อให้ JavaScript ของ SPA จัดการ routing
[[redirects]]
  from = "/location/*"
  to = "/index.html"
  status = 200
  force = true # 'force = true' สำคัญสำหรับ SPA

[[redirects]]
  from = "/province/*"
  to = "/index.html"
  status = 200
  force = true

[[redirects]]
  from = "/profiles/*"
  to = "/index.html"
  status = 200
  force = true

# 4. SPA Fallback ทั่วไป (200 OK Rewrite)
#    - นี่คือกฎ "catch-all" ที่จะทำงานเมื่อไม่มีกฎ Redirect/Rewrite อื่นๆ ทำงาน
#    - ส่งทุก Request ที่เหลือไปยัง index.html เพื่อให้ SPA จัดการ
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200