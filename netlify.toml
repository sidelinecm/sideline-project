# =====================================
# üèóÔ∏è Netlify Build Configuration
# =====================================
[build]
  publish = "."
  command = "" 
  environment = { NODE_VERSION = "18" }

# =====================================
# üíª Edge Functions (SEO & Routing Engine)
# =====================================

# 1. Dynamic Sitemap (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏°‡∏≤‡∏Å: ‡∏™‡∏£‡πâ‡∏≤‡∏á XML ‡∏™‡∏î‡πÜ ‡∏à‡∏≤‡∏Å Database)
[[edge_functions]]
function = "sitemap"
path = "/sitemap.xml"

# 2. ‡∏´‡∏ô‡πâ‡∏≤‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö SEO, Schema, Bot Rendering)
[[edge_functions]]
function = "render-bot"
path = "/profile/*"

[[edge_functions]]
function = "render-bot"
path = "/sideline/*"

[[edge_functions]]
function = "render-bot"
path = "/app/*"

# 3. ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î/‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà (‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö SEO Listing)
[[edge_functions]]
function = "ssr-province"
path = "/province/*"

[[edge_functions]]
function = "ssr-province"
path = "/location/*"

# =====================================
# ‚öôÔ∏è Global HTTP Security Headers
# =====================================
[[headers]]
  for = "/*"
  [headers.values]
    X-Content-Type-Options = "nosniff"
    X-Frame-Options = "SAMEORIGIN"
    X-XSS-Protection = "1; mode=block"
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload"
    Referrer-Policy = "strict-origin-when-cross-origin"
    Permissions-Policy = "geolocation=(), microphone=(), camera=()"

# =====================================
# ‚ö° Cache Control Strategy
# =====================================

# HTML: ‡πÉ‡∏´‡πâ Cache ‡∏™‡∏±‡πâ‡∏ô‡πÜ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏î‡πÉ‡∏´‡∏°‡πà
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "public, max-age=0, must-revalidate"

# Assets: Cache ‡∏¢‡∏≤‡∏ß‡πÜ 1 ‡∏õ‡∏µ (Immutable) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (Core Web Vitals)
[[headers]]
  for = "/fonts/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/css/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/js/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# Service Worker & Manifest (‡∏´‡πâ‡∏≤‡∏° Cache)
[[headers]]
  for = "/sw.js"
  [headers.values]
    Cache-Control = "no-store, no-cache, must-revalidate"

[[headers]]
  for = "/manifest.webmanifest"
  [headers.values]
    Cache-Control = "public, max-age=86400"

# =====================================
# üîÄ Redirect Rules (SPA Routing)
# =====================================

# ‡∏Å‡∏é‡∏ó‡∏µ‡πà 1: ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÉ‡∏ä‡πâ HTTPS ‡πÅ‡∏•‡∏∞ non-www (‡∏´‡∏£‡∏∑‡∏≠ www ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î Duplicate Content
# [[redirects]]
#   from = "http://*"
#   to = "https://sidelinechiangmai.netlify.app/:splat"
#   status = 301
#   force = true

# ‡∏Å‡∏é‡∏ó‡∏µ‡πà 2: SPA Fallback (‡∏™‡πà‡∏á‡∏ó‡∏∏‡∏Å Request ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á‡πÑ‡∏õ index.html)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
