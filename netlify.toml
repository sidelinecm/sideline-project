[build]
  publish = "."
  functions = "netlify/functions"

[build.processing]
  skip_processing = false
[build.processing.html]
  pretty_urls = true  # ตัวนี้จัดการเรื่องลบ .html ให้เองแบบฉลาด ไม่ต้องใส่กฎ Manual

# --- Security Headers ---
[[headers]]
  for = "/*"
  [headers.values]
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload"
    X-Frame-Options = "ALLOWALL" 
    Referrer-Policy = "no-referrer-when-downgrade"
    Cache-Control = "public, max-age=0, must-revalidate"
    X-Robots-Tag = "index, follow"

# --- [1] Edge Functions (รันก่อนเพื่อน) ---
[[edge_functions]]
  function = "sitemap"
  path = "/sitemap.xml"

[[edge_functions]]
  function = "render-bot"
  path = "/sideline/*"

[[edge_functions]]
  function = "ssr-province"
  path = "/location/*"

# --- [2] Specific Redirects (ดัก Link เก่า/เลขซ้ำ) ---
# บังคับ HTTPS
[[redirects]]
  from = "http://sidelinechiangmai.netlify.app/*"
  to = "https://sidelinechiangmai.netlify.app/:splat"
  status = 301

# ตัวอย่างการแก้เลขซ้ำ (ใส่เฉพาะตัวที่จำเป็นจริงๆ)
[[redirects]]
  from = "/sideline/obwi-96-96-96"
  to = "/sideline/obwi-96"
  status = 301

[[redirects]]
  from = "/sideline/nongmaprang-154-154-154"
  to = "/sideline/nongmaprang-154"
  status = 301

# --- [3] SPA Fallback (กฎสุดท้าย) ---
[[redirects]]
  from = "/sw.js"
  to = "/sw.js"
  status = 200

[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200