[build]
  # ตรวจสอบว่าไฟล์ index.html ของคุณอยู่ที่ root (.) หรือใน folder ชื่อ public/dist
  # ถ้าไฟล์อยู่ที่ root ให้ใช้ "." ถ้าอยู่ใน public ให้แก้เป็น "public"
  publish = "." 
  functions = "netlify/functions"

[build.processing]
  skip_processing = false

# --- [1] Headers (Global) ---
[[headers]]
  for = "/*"
  [headers.values]
    # ❌ ลบ X-Robots-Tag ออก ให้ไปคุมในไฟล์ JS หรือ Meta tag แทน
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "no-referrer-when-downgrade"
    # เพิ่ม Cache-Control เบื้องต้น (Edge Function จะ override เองถ้าจำเป็น)
    Cache-Control = "public, max-age=0, must-revalidate"

# --- [2] Edge Functions ---
# Netlify จะรัน Edge Functions ก่อน Redirects เสมอ
# ตรวจสอบให้แน่ใจว่าไฟล์ชื่อ sitemap.js, render-bot.js, ssr-province.js อยู่ใน folder netlify/edge-functions

[[edge_functions]]
  function = "sitemap"
  path = "/sitemap.xml"

[[edge_functions]]
  function = "render-bot"
  path = "/sideline/*"

[[edge_functions]]
  function = "ssr-province"
  path = "/location/*"

# --- [3] Redirects ---

# 3.1 บังคับ HTTPS (SEO Standard)
[[redirects]]
  from = "http://sidelinechiangmai.netlify.app/*"
  to = "https://sidelinechiangmai.netlify.app/:splat"
  status = 301
  force = true

# 3.2 จัดการ Link เก่าที่เสีย (สำคัญมากสำหรับคะแนน SEO เดิม)
[[redirects]]
  from = "/sideline/nongmaprang-154-154-154"
  to = "/sideline/nongmaprang-154"
  status = 301
  force = true

[[redirects]]
  from = "/sideline/obwi-96-96-96"
  to = "/sideline/obwi-96"
  status = 301
  force = true

[[redirects]]
  from = "/sideline/pay-136-136-136"
  to = "/sideline/pay-136"
  status = 301
  force = true

# ดักจับลิงก์ภาษาไทย
[[redirects]]
  from = "/sideline/%E0%B8%9B%E0%B8%B9%E0%B9%80%E0%B8%9B%E0%B9%82"
  to = "/sideline/puep-87"
  status = 301

# จัดการนามสกุลไฟล์เก่า .html
[[redirects]]
  from = "/profiles/*.html"
  to = "/profiles/:splat"
  status = 301
  force = true

# --- [4] SPA Fallback (กฎสุดท้าย) ---
# สำคัญ: ถ้า Edge Function (render-bot) สั่ง context.next() 
# มันจะหลุดมาที่กฎนี้ เพื่อให้ Client-Side Rendering ทำงานต่อ (ไม่เกิดหน้าขาว)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200