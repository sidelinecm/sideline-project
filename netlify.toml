# =========================================================================
# ส่วนที่ 1: การตั้งค่า Build
# =========================================================================
[build]
  publish = "." [cite: 1]
  functions = "netlify/functions" [cite: 2]

[build.processing]
  skip_processing = false [cite: 2]
[build.processing.html]
  pretty_urls = true [cite: 2]

# =========================================================================
# ส่วนที่ 2: HTTP Headers (Security & Cache)
# =========================================================================
[[headers]]
  for = "/*" [cite: 3]
  [headers.values]
    X-Content-Type-Options = "nosniff" [cite: 3]
    X-Frame-Options = "SAMEORIGIN" [cite: 3]
    X-XSS-Protection = "1; mode=block" [cite: 3]
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload" [cite: 3]
    Referrer-Policy = "strict-origin-when-cross-origin" [cite: 3]
    Cache-Control = "public, max-age=0, must-revalidate" [cite: 3]

# =========================================================================
# ส่วนที่ 3: Netlify Edge Functions
# (ลำดับสำคัญมาก: Edge Functions จะทำงานก่อน Redirects เสมอ)
# =========================================================================
[[edge_functions]]
  function = "sitemap"
  path = "/sitemap.xml" [cite: 4]

[[edge_functions]]
  function = "render-bot"
  path = "/sideline/*" [cite: 4]

[[edge_functions]]
  function = "ssr-province"
  path = "/location/*" [cite: 4]

[[edge_functions]]
  function = "ssr-province"
  path = "/province/*" [cite: 4]

# เพิ่ม Edge Function สำหรับ Profiles (ถ้าคุณมี function สำหรับจัดการหน้านี้)
# [[edge_functions]]
#   function = "ssr-profile" 
#   path = "/profiles/*"

# =========================================================================
# ส่วนที่ 4: Redirects & Rewrites (SPA Fallback)
# =========================================================================

# 1. บังคับ HTTPS
[[redirects]]
  from = "http://sidelinechiangmai.netlify.app/*"
  to = "https://sidelinechiangmai.netlify.app/:splat" [cite: 5]
  status = 301
  force = true [cite: 5]

# 2. ปล่อยให้ไฟล์จริง (Static Files) ทำงาน โดยไม่ต้อง Rewrite
# เอา force = true ออกเพื่อให้เบราว์เซอร์หาไฟล์ sw.js หรือ assets เจอจริงๆ
[[redirects]]
  from = "/sw.js"
  to = "/sw.js"
  status = 200 [cite: 6]

[[redirects]]
  from = "/manifest.webmanifest"
  to = "/manifest.webmanifest"
  status = 200 [cite: 6]

# 3. SPA Catch-all (หัวใจสำคัญ)
# ใช้กฎเดียวครอบคลุมทุก Path ที่ไม่ใช่ไฟล์จริง
# การเอา force = true ออกในส่วนนี้ จะช่วยให้หากมีไฟล์ชื่อนั้นจริงๆ Netlify จะเปิดไฟล์นั้น 
# แต่ถ้าไม่มี (เช่น URL ของ Router) มันจะส่งไปที่ index.html ให้เองโดยอัตโนมัติ
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200 [cite: 7]