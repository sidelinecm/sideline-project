[build]
  publish = "."
  functions = "netlify/functions"

[build.processing]
  skip_processing = false
[build.processing.html]
  pretty_urls = true 

# --- [1] Headers (ดีต่อ SEO) ---
[[headers]]
  for = "/*"
  [headers.values]
    X-Robots-Tag = "index, follow"
    X-Content-Type-Options = "nosniff"
    Referrer-Policy = "no-referrer-when-downgrade"

# --- [2] Edge Functions (รันอันดับ 1 เพื่อให้บอทเห็นข้อมูล) ---
[[edge_functions]]
  function = "sitemap"
  path = "/sitemap.xml"

[[edge_functions]]
  function = "render-bot"
  path = "/sideline/*"

[[edge_functions]]
  function = "ssr-province"
  path = "/location/*"

# --- [3] Redirects (ย้ายมาจาก _redirects เพื่อโอนคะแนน SEO) ---

# บังคับ HTTPS
[[redirects]]
  from = "http://sidelinechiangmai.netlify.app/*"
  to = "https://sidelinechiangmai.netlify.app/:splat"
  status = 301

# ตัวอย่างการดักเลขซ้ำ (โอนคะแนนจากลิงก์เก่ามาลิงก์ใหม่ที่สะอาด)
# ผมรวมตัวที่สำคัญๆ มาให้ครับ
[[redirects]]
  from = "/sideline/nongmaprang-154-154-154"
  to = "/sideline/nongmaprang-154"
  status = 301
  force = true

[[redirects]]
  from = "/sideline/obwi-96-96-96"
  to = "/sideline/obwi-96"
  status = 301
  force = true

[[redirects]]
  from = "/sideline/pay-136-136-136"
  to = "/sideline/pay-136"
  status = 301
  force = true

# ดักจับลิงก์ภาษาไทย (URL Encode)
[[redirects]]
  from = "/sideline/%E0%B8%9B%E0%B8%B9%E0%B9%80%E0%B8%9B%E0%B9%82"
  to = "/sideline/puep-87"
  status = 301

# --- [4] SPA Fallback (กฎสุดท้าย ห้ามย้ายขึ้นข้างบน) ---
# ตัวนี้จะทำให้กด Refresh หน้าโปรไฟล์แล้วไม่ขาว และไม่เกิด Loop
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200